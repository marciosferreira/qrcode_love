{% extends "base.html" %}
{% block content %}
<div class="glass-card">
  <h2>Pagamento confirmado</h2>
  <p style="margin-bottom:1rem; color: var(--text-muted);">
    Obrigado! Seu pagamento foi processado.
  </p>
  <p style="margin-bottom:1rem;">Você pode continuar pelo botão abaixo.</p>
  <a href="{{ redirect_url }}" class="btn btn-primary">Ir agora</a>
</div>
{% endblock %}

{% block scripts %}
{% set gtag_id = GA_MEASUREMENT_ID or aw_id %}
{% if gtag_id %}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ gtag_id }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);} 
  gtag('js', new Date());
  
  (function() {
    var params = new URLSearchParams(window.location.search);
    var debug = params.has('debug') || params.has('_dbg') || params.has('debug_mode');
    
    var ga4Id = '{{ GA_MEASUREMENT_ID|default("") }}';
    var awId = '{{ aw_id|default("") }}';
    var awLabel = '{{ aw_label|default("") }}';
    var convValue = '{{ conv_value|default("0") }}';
    
    if (ga4Id) {
      gtag('config', ga4Id, { 'debug_mode': debug });
    }
    
    if (awId) {
      gtag('config', awId);
    }
    
    var v = Number(convValue);
    if (!v || v <= 0) {
      var vq = params.get('v');
      if (vq) v = Number(vq.replace(',', '.'));
    }
    v = (isFinite(v) && v > 0) ? v : 0;
    
    if (ga4Id) {
      gtag('event', 'purchase', {
        value: v,
        currency: 'BRL'
      });
    }
    
    if (awId && awLabel) {
      gtag('event', 'conversion', {
        'send_to': awId + '/' + awLabel,
        'value': v,
        'currency': 'BRL'
      });
    }
  })();
</script>
{% endif %}
{% endblock %}