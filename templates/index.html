{% extends "base.html" %}

{% block title %}Meu Evento Especial ‚Äî Compartilhe com QR Code, Fotos e V√≠deo{% endblock %}
{% block head %}
<link href="https://cdn.quilljs.com/1.3.7/quill.bubble.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Meu Evento Especial",
  "url": "{{ canonical_url }}",
  "inLanguage": "pt-BR",
  "publisher": {
    "@type": "Organization",
    "name": "Meu Evento Especial",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ url_for('static', filename='images/logo_qrcode_heart_transparent.png', _external=True) }}"
    }
  }
}
</script>
<style>
  /* Layout de se√ß√µes modernas para destacar cada feature (alinha com p√°gina do casal) */
  .page-wrap { max-width: 960px; margin: 0 auto; padding: 24px; }
  .section-title { color: var(--text-muted); font-size: 0.95rem; text-transform: uppercase; letter-spacing: 2px; margin: 0 0 .75rem; }
  .section-card { background: rgba(0,0,0,0.45); border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; padding: 1.25rem; margin: 1.25rem 0; box-shadow: 0 6px 24px rgba(0,0,0,0.30); }
  .section-sep { height: 1px; border: none; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent); margin: 1.5rem 0; }
  @media (max-width: 640px) { .page-wrap { padding: 12px; } }
</style>
{% endblock %}

{% block content %}
<div class="page-wrap">
<section class="section-card text-center">
  <h1>Crie sua P√°gina Especial</h1>
  <p class="lead" style="color: var(--text-muted);">
    Reviva momentos ou conte o tempo para um evento especial. Crie uma p√°gina personalizada com QR Code, fotos e v√≠deo.
  </p>
</section>

<div class="grid-2">
  <!-- Form Section -->
  <section class="section-card">
    <h2>Personalize</h2>
    <form action="/create" method="POST" enctype="multipart/form-data" id="createForm">

      <div class="form-group">
        <label class="form-label">Nomes do Casal / Pessoas</label>
        <div class="grid-2" style="gap: 10px;">
          <input type="text" class="form-control" id="name1" name="name1" placeholder="Nome 1" required>
          <input type="text" class="form-control" id="name2" name="name2" placeholder="Nome 2 (opcional)">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Data e Hora do Evento</label>
        <div class="grid-2" style="gap: 10px;">
          <input type="date" class="form-control" id="event_date" name="event_date" required>
          <input type="time" class="form-control" id="event_time" name="event_time" required>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Tipo de Contagem</label>
        <div class="custom-radio-group">
          <div class="radio-option">
            <input type="radio" name="counter_mode" id="mode_since" value="since" checked>
            <label class="radio-label" for="mode_since">
              <i class="bi bi-clock-history"></i> Tempo desde...
            </label>
          </div>
          <div class="radio-option">
            <input type="radio" name="counter_mode" id="mode_until" value="until">
            <label class="radio-label" for="mode_until">
              <i class="bi bi-hourglass-split"></i> Contagem para...
            </label>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Descri√ß√£o do Evento</label>
        <div class="d-flex gap-2" style="margin-bottom: 10px;">
          <input type="checkbox" id="customPhraseToggle">
          <label for="customPhraseToggle" style="cursor: pointer; color: var(--text-muted);">Usar frase
            personalizada</label>
        </div>

        <select name="event_description" id="eventSelect" class="form-control">
          <optgroup label="Relacionamentos amorosos üíë">
            <option value="se casaram">se casaram</option>
            <option value="se conheceram">se conheceram</option>
            <option value="come√ßaram a namorar">come√ßaram a namorar</option>
            <option value="noivaram">noivaram</option>
          </optgroup>
          <optgroup label="Outros Momentos üéâ">
            <option value="se tornaram amigos">se tornaram amigos</option>
            <option value="nasceu">nasceu</option>
            <option value="realizou um sonho">realizou um sonho</option>
          </optgroup>
        </select>

        <input type="text" name="custom_event_description" id="customPhraseInput" class="form-control d-none"
          placeholder="Ex: vamos viajar para a Disney">
        <input type="hidden" name="description_mode" id="descriptionMode" value="select">
      </div>

      <div class="form-group">
        <label class="form-label">M√≠dia</label>
        <input type="text" class="form-control" id="youtubeLink" name="youtubeLink"
          placeholder="Link do YouTube (opcional)" style="margin-bottom: 10px;">
        <label class="form-label" style="font-size: 0.9rem;">Fotos (at√© 3)</label>
        <input type="file" class="form-control" id="images" name="images" accept="image/png, image/jpeg" multiple>
        <input type="hidden" id="imageAdjustments" name="image_adjustments">
      </div>

      <div class="form-group">
        <label class="form-label">Efeitos e Fundo</label>
        <div class="grid-2" style="gap: 10px;">
          <select id="imageEffectSelector" name="effect_type" class="form-control">
            <option value="none">Sem efeito</option>
            <option value="hearts">Cora√ß√µes ‚ù§Ô∏è</option>
            <option value="stars">Estrelas ‚≠ê</option>
            <option value="confetti">Confetes üéâ</option>
          </select>
          <select id="backgroundSelector" name="background_type" class="form-control">
            <optgroup label="Gradientes Escuros üåë">
              <option value="gradient_dark8" selected>Padr√£o (Preto/Vermelho)</option>
              <option value="gradient_dark1">Roxo/Azul</option>
              <option value="gradient_dark5">Azul/P√∫rpura</option>
              <option value="gradient_forest">Floresta Noturna</option>
              <option value="gradient_berry">Frutas Vermelhas</option>
            </optgroup>
            <optgroup label="Gradientes Vibrantes üåà">
              <option value="gradient_sunset">P√¥r do Sol</option>
              <option value="gradient_ocean">Oceano Profundo</option>
              <option value="gradient_love">Amor Ardente</option>
            </optgroup>
            <optgroup label="Texturas Especiais üé®">
              <option value="texture_rainbow">Arco-√≠ris Pastel</option>
              <option value="texture_marble">M√°rmore Elegante</option>
              <option value="texture_paper">Papel Antigo</option>
            </optgroup>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Seu e-mail</label>
        <input type="email" class="form-control" id="email" name="email" placeholder="Seu e-mail" required
          style="margin-bottom: 10px;">
      </div>

      <div class="form-group">
        <label class="form-label">Sua mensagem especial (opcional)</label>
        <div id="message_editor" class="form-control" style="min-height: 120px; padding: 8px;"></div>
        <textarea id="message" name="optional_message" class="d-none"></textarea>
      </div>

      <button type="submit" class="btn btn-primary full-width" id="submitBtn">Criar P√°gina Especial</button>
    </form>
  </section>

  <!-- Preview Section (espelhando os cards da p√°gina do casal) -->
  <div>
    <!-- Card: Nomes + Contador + Descri√ß√£o -->
    <div class="section-card text-center">
      <div class="section-title">Pr√©via</div>
      <h2 class="special-text">Homenagem a</h2>
      <div id="namesPreview" style="margin: 1rem 0; display:flex; justify-content:center; align-items:center; gap:.5rem;">
        <h1 id="couple_name1">Nome 1</h1>
        <span id="e_comercial" class="special-text" style="display: none; font-size: 2rem;">&</span>
        <h1 id="couple_name2" style="display: none;">Nome 2</h1>
      </div>

      <hr class="section-sep">

      <h3 id="counter_prefix_text">J√° se passaram:</h3>
      <div id="event-data" style="display:none" data-counter-mode="since"></div>
      <div class="counter-wrapper" id="meu-contador">
        <div class="time-box"><span class="time-value">0</span><span class="time-label">Anos</span></div>
        <div class="time-box"><span class="time-value">0</span><span class="time-label">Meses</span></div>
        <div class="time-box"><span class="time-value">0</span><span class="time-label">Dias</span></div>
      </div>
      <h3 id="event_description_text" class="special-text" style="font-size: 1.6rem; margin-top: 1rem;">desde que...</h3>
      <div id="finish-message" style="margin-top:.5rem;"></div>
    </div>

    <!-- Card: Fotos -->
    <div class="section-card">
      <div class="section-title">Fotos</div>
      <div id="carousel" class="carousel-container"
        style="position: relative; height: 400px; border-radius: 16px; overflow: hidden; background: rgba(0,0,0,0.45);">
        <img src="https://meueventoespecial.com.br/static/images/placeholder.png" class="carousel-image active"
          alt="Preview"
          style="width: 100%; height: 100%; object-fit: contain; position: absolute; top: 0; left: 0; transition: opacity 1s;">

        <button type="button" id="editPhotoBtn" class="btn-glass-icon"
          style="position: absolute; top: 10px; right: 10px; z-index: 10; display: none;" title="Ajustar Foto">
          <i class="bi bi-pencil-fill"></i>
        </button>

        <div id="presentationEffectContainer"
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;"></div>
      </div>
    </div>

    <!-- Card: Mensagem especial -->
    <div class="section-card message">
      <div class="section-title">Mensagem especial</div>
      <p id="optional_message_text" style="font-style: italic; color: var(--text-muted); margin-top: .5rem; white-space: pre-wrap;">Sua mensagem especial</p>
    </div>

    <!-- Card: V√≠deo -->
    <div class="section-card">
      <div class="section-title">V√≠deo</div>
      <div id="videoPreviewContainer" style="margin-top: .5rem; border-radius: 16px; overflow: hidden; display: none;"></div>
    </div>

    <!-- Card: Compartilhar (QR exemplo) -->
    <div class="section-card">
      <div class="section-title">Compartilhar</div>
      <div style="text-align:center;">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://meueventoespecial.com.br"
          alt="QR Code Exemplo" style="width: 150px; height: 150px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); background: white; padding: 8px; display:inline-block;">
        <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 10px;">Exemplo de QR Code</p>
      </div>
    </div>
  </div>
</div>

<div id="photoAdjustmentModal" class="modal-overlay" style="display: none;">
  <div class="glass-card modal-content" style="max-width: 500px; width: 90%; padding: 2rem; position: relative;">
    <h3 style="margin-bottom: 1rem;">Ajustar Foto</h3>
    <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1rem;">Arraste para mover e use a barra para
      dar zoom.</p>

      <div id="adjustmentContainer"
      style="width: 100%; overflow: hidden; position: relative; border-radius: 12px; background: #000; cursor: grab; margin-bottom: 1.5rem; touch-action: none;">
      <img id="adjustmentImage" src=""
        style="width: 100%; height: 100%; object-fit: contain; transform-origin: center; pointer-events: none; user-select: none;">
      <!-- Overlay de guia: regra dos ter√ßos + marca central -->
      <div id="guideOverlay" style="position: absolute; inset: 0; pointer-events: none;">
        <!-- Linhas verticais -->
        <div style="position:absolute; left:33.33%; top:0; width:1px; height:100%; background:rgba(255,255,255,0.35);"></div>
        <div style="position:absolute; left:66.66%; top:0; width:1px; height:100%; background:rgba(255,255,255,0.35);"></div>
        <!-- Linhas horizontais -->
        <div style="position:absolute; top:33.33%; left:0; height:1px; width:100%; background:rgba(255,255,255,0.35);"></div>
        <div style="position:absolute; top:66.66%; left:0; height:1px; width:100%; background:rgba(255,255,255,0.35);"></div>
        <!-- Marca central (alvo) -->
        <div style="position:absolute; top:50%; left:50%; width:12px; height:12px; margin-left:-6px; margin-top:-6px; border-radius:50%; border:2px solid rgba(255,255,255,0.7);"></div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Zoom</label>
      <input type="range" id="zoomSlider" min="0.5" max="5" step="0.1" value="1" style="width: 100%;">
    </div>

    <div class="form-group" style="margin-top: 1rem;">
      <label class="form-label">Rota√ß√£o</label>
      <div class="d-flex gap-2" style="align-items: center;">
        <button type="button" id="rotateLeft90" class="btn btn-secondary">-90¬∞</button>
        <input type="range" id="rotateSlider" min="-180" max="180" step="1" value="0" style="flex: 1;">
        <button type="button" id="rotateRight90" class="btn btn-secondary">+90¬∞</button>
      </div>
    </div>

    <div class="d-flex gap-2" style="justify-content: flex-end; margin-top: 1rem;">
      <button type="button" id="cancelAdjustmentBtn" class="btn btn-secondary">Cancelar</button>
      <button type="button" id="saveAdjustmentBtn" class="btn btn-primary">Salvar Ajuste</button>
    </div>
  </div>
</div>

</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  const quill = new Quill('#message_editor', {
    theme: 'bubble',
    modules: { toolbar: [["bold", "italic"], [{ list: "bullet" }], ["clean"]] }
  });
  const hiddenMsgField = document.getElementById('message');
  const previewMsg = document.getElementById('optional_message_text');
  function updateMessageFromEditor() {
    const html = quill.root.innerHTML.trim();
    hiddenMsgField.value = html;
    previewMsg.innerHTML = html || 'Sua mensagem especial';
  }
  quill.on('text-change', updateMessageFromEditor);
  document.getElementById('createForm').addEventListener('submit', updateMessageFromEditor);
</script>
<script src="{{ url_for('static', filename='js/script.js') }}"></script>
{% endblock %}
